<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Mark a process and its (future) child tree — ps_mark_tree • ps</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Mark a process and its (future) child tree — ps_mark_tree" />
<meta property="og:description" content="ps_mark_tree() generates a random environment variable name and sets
it in the  current R process. This environment variable will be (by
default) inherited by all child (and grandchild, etc.) processes, and
will help finding these processes, even if and when they are (no longer)
related to the current R process. (I.e. they are not connected in the
process tree.)" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ps</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.3.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/ps/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Mark a process and its (future) child tree</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/ps/blob/master/R/kill-tree.R'><code>R/kill-tree.R</code></a></small>
    <div class="hidden name"><code>ps_kill_tree.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>ps_mark_tree()</code> generates a random environment variable name and sets
it in the  current R process. This environment variable will be (by
default) inherited by all child (and grandchild, etc.) processes, and
will help finding these processes, even if and when they are (no longer)
related to the current R process. (I.e. they are not connected in the
process tree.)</p>
    </div>

    <pre class="usage"><span class='fu'>ps_mark_tree</span>()

<span class='fu'>with_process_cleanup</span>(<span class='kw'>expr</span>)

<span class='fu'>ps_find_tree</span>(<span class='kw'>marker</span>)

<span class='fu'>ps_kill_tree</span>(<span class='kw'>marker</span>, sig = <span class='fu'><a href='signals.html'>signals</a></span>()<span class='op'>$</span><span class='kw'>SIGKILL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>R expression to evaluate in the new context.</p></td>
    </tr>
    <tr>
      <th>marker</th>
      <td><p>String scalar, the name of the environment variable to
use to find the marked processes.</p></td>
    </tr>
    <tr>
      <th>sig</th>
      <td><p>The signal to send to the marked processes on Unix. On
Windows this argument is ignored currently.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>ps_mark_tree()</code> returns the name of the environment variable,
which can be used as the <code>marker</code> in <code>ps_kill_tree()</code>.</p>
<p><code>ps_find_tree()</code> returns a list of <code>ps_handle</code> objects.</p>
<p><code>ps_kill_tree()</code> returns the pids of the killed processes, in a named
integer vector. The names are the file names of the executables, when
available.</p>
<p><code>with_process_cleanup()</code> returns the value of the evaluated expression.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>ps_find_tree()</code> finds the processes that set the supplied environment
variable and returns them in a list.</p>
<p><code>ps_kill_tree()</code> finds the processes that set the supplied environment
variable, and kills them (or sends them the specified signal on Unix).</p>
<p><code>with_process_cleanup()</code> evaluates an R expression, and cleans up all
external processes that were started by the R process while evaluating
the expression. This includes child processes of child processes, etc.,
recursively. It returns a list with entries: <code>result</code> is the result of
the expression, <code>visible</code> is TRUE if the expression should be printed
to the screen, and <code>process_cleanup</code> is a named integer vector of the
cleaned pids, names are the process names.</p>
<p>If <code>expr</code> throws an error, then so does <code>with_process_cleanup()</code>, the
same error. Nevertheless processes are still cleaned up.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    

<p>Note that <code>with_process_cleanup()</code> is problematic if the R process is
multi-threaded and the other threads start subprocesses.
<code>with_process_cleanup()</code> cleans up those processes as well, which is
probably not what you want. This is an issue for example in RStudio.
Do not use <code>with_process_cleanup()</code>, unless you are sure that the
R process is single-threaded, or the other threads do not start
subprocesses. E.g. using it in package test cases is usually fine,
because RStudio runs these in a separate single-threaded process.</p>
<p>The same holds for manually running <code>ps_mark_tree()</code> and then
<code>ps_find_tree()</code> or <code>ps_kill_tree()</code>.</p>
<p>A safe way to use process cleanup is to use the processx package to
start subprocesses, and set the <code>cleanup_tree = TRUE</code> in
<code><a href='http://processx.r-lib.org/reference/run.html'>processx::run()</a></code> or the <a href='http://processx.r-lib.org/reference/process.html'>processx::process</a> constructor.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jay Loden, Dave Daeschler, Giampaolo Rodola', <a href='https://github.com/gaborcsardi'>Gábor Csárdi</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


